summary(payg$clients)
table(payg$fy)
table(payg$industry)
summary(payg$installments)
payg[, i_c := installments/clients]
summary(payg$i_c)
View(payg)
ts_ = payg[, .(mean(i_c)), by = .(entity, industry, fy)]
ts_
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
?ts
ts_ = ts(data = ts_, start = 2011, end = 2019, deltat = 1)
ts_
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
library(ggplot2)
install.packages("ggplot2")
library(ggplot2)
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line()
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry, linetype = industry))
library(dplyr)
library(magrittr)
individuals %<>% gather(key = "industry", value = "mean_i_c", fy)
library(tidyverse)
install.packages('tidyverse')
install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
individuals %<>% gather(key = "industry", value = "mean_i_c", fy)
?magrittr
%<>%
library(magrittr)
individuals %<>% gather(key = "industry", value = "mean_i_c", fy)
library(tidyverse)
individuals %<>% gather(key = "industry", value = "mean_i_c", fy)
?gather
??gather
library(tidyr)
individuals %<>% gather(key = "industry", value = "mean_i_c", fy)
??gather
individuals %<>% pivot_longer(key = "industry", value = "mean_i_c", fy)
?pivot_longer
??pivot_longer
?pivot
library(dplyr)
individuals %<>% pivot_longer(key = "industry", value = "mean_i_c", fy)
install.packages('tidyr')
install.packages("tidyr")
library(tidyr)
?pivot_longer
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry, linetype = industry))
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(plyr)
library(ggplot2)
library(dplyr)
library(magrittr)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(plyr)
library(ggplot2)
library(dplyr)
library(magrittr)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(plyr)
library(ggplot2)
library(dplyr)
library(magrittr)
#library(tidyverse)
payg = fread("../data/payg_installments.csv")
# fix years
old = unique(payg$Year2)
new = 2011:2019
payg[, fy := mapvalues(Year2, old, new)]
payg[, Year2 := NULL]
# industry
payg[, industry := substr(`Broad Industry1`, 1, 1)]
payg[, `Broad Industry1` := NULL]
# $
payg[, installments := as.numeric(gsub(",", "", `PAYGI$`))]
payg[, `PAYGI$` := NULL]
# entity type
setnames(payg, "Entity Type", "entity")
# clients
setnames(payg, "Number of clients", "clients")
payg[, clients := as.numeric(gsub(",", "", clients))]
table(payg$entity)
summary(payg$clients)
table(payg$fy)
table(payg$industry)
summary(payg$installments)
payg[, i_c := installments/clients]
summary(payg$i_c)
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry, linetype = industry))
individuals
length(unique(individuals[, .(fy, industry)]))
individuals[, .N, by = industry]
individuals = ts_[, industry := as.factor(industry)]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry, linetype = industry))
class(individuals$fy)
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, industry := as.factor(industry)]
individuals[, fy := as.numeric(fy)]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry, linetype = industry))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry))
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years, - mean_)
unique(mean_all_years$industry)
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(plyr)
library(ggplot2)
library(dplyr)
library(magrittr)
#library(tidyverse)
payg = fread("../data/payg_installments.csv")
# fix years
old = unique(payg$Year2)
new = 2011:2019
payg[, fy := mapvalues(Year2, old, new)]
payg[, Year2 := NULL]
# industry
payg[, industry := substr(`Broad Industry1`, 1, 1)]
payg[, `Broad Industry1` := NULL]
# $
payg[, installments := as.numeric(gsub(",", "", `PAYGI$`))]
payg[, `PAYGI$` := NULL]
# entity type
setnames(payg, "Entity Type", "entity")
# clients
setnames(payg, "Number of clients", "clients")
payg[, clients := as.numeric(gsub(",", "", clients))]
table(payg$entity)
summary(payg$clients)
table(payg$fy)
table(payg$industry)
summary(payg$installments)
payg[, i_c := installments/clients]
summary(payg$i_c)
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry))
payg = fread("../data/payg_installments.csv")
unique(payg$`Broad Industry1`)
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(plyr)
library(ggplot2)
library(dplyr)
library(magrittr)
#library(tidyverse)
payg = fread("../data/payg_installments.csv")
# fix years
old = unique(payg$Year2)
new = 2011:2019
payg[, fy := mapvalues(Year2, old, new)]
payg[, Year2 := NULL]
# industry
payg[, industry := substr(`Broad Industry1`, 1, 1)]
setnames(payg, "Broad Industry1", "industry_name")
# $
payg[, installments := as.numeric(gsub(",", "", `PAYGI$`))]
payg[, `PAYGI$` := NULL]
# entity type
setnames(payg, "Entity Type", "entity")
# clients
setnames(payg, "Number of clients", "clients")
payg[, clients := as.numeric(gsub(",", "", clients))]
table(payg$entity)
summary(payg$clients)
table(payg$fy)
table(payg$industry)
summary(payg$installments)
payg[, i_c := installments/clients]
summary(payg$i_c)
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry))
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
theme(axis.text.x = 2011:2019)
?element_line
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(limits = element_text(2011:2019))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "lol", limits = element_text(2011:2019))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_continuous(name = "lol", limits = element_text(2011:2019))
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "lol", limits = c(2011:2019))
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = industry]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_continuous(name = "End of financial year", limits = c(2011:2019))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = factor(2011:2019))
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019))
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy, industry_name)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019))
# Industry table
mean_all_years
# Industry table
mean_all_years[, .(industry, industry_name)]
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy, industry_name)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019))
# Industry table
mean_all_years[, .(industry, industry_name)]
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy, industry_name)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "Mean installments per client over time by industry for individuals")
# Industry table
mean_all_years[, .(industry, industry_name)]
tapply(X = payg, INDEX = payg$entity, FUN = summary(installments))
tapply(X = payg, INDEX = payg$entity, FUN = summary(payg$installments))
tapply(X = payg, INDEX = payg$entity, FUN = summary())
tapply(X = payg$installments, INDEX = payg$entity, FUN = summary())
tapply(X = payg$installments, INDEX = payg$entity, FUN = summary
tapply(X = payg$installments, INDEX = payg$entity, FUN = summary)
tapply(X = payg$installments, INDEX = payg$entity, FUN = summary())
tapply(X = payg$installments, INDEX = payg$entity, FUN = mean())
tapply(X = payg$installments, INDEX = payg$entity, FUN = mean)
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy, industry_name)]
individuals = ts_[entity == "Companies", .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = mean_i_c)) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "Mean installments per client over time by industry for companies")
# Industry table
mean_all_years[, .(industry, industry_name)]
# plot
ggplot(data = individuals, aes(x = fy, y = log(mean_i_c))) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "Mean installments per client over time by industry for companies")
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy, industry_name)]
individuals = ts_[entity == "Companies", .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = log(mean_i_c))) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "log(Mean installments per client) over time by industry for companies")
# Industry table
mean_all_years[, .(industry, industry_name)]
exp(10)
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(entity, industry, fy, industry_name)]
individuals = ts_[entity == "Individuals", .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = log(mean_i_c))) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "Log Mean installments per client over time by industry for individuals")
# Industry table
mean_all_years[, .(industry, industry_name)]
ts_ = payg[, .(mean_i_c = mean(i_c)), by = .(industry, fy, industry_name)]
individuals = ts_[entity %in% c("Companies", "Individuals"), .(mean_i_c, industry, fy, industry_name)]
ts_ = payg[entity %in% c("Companies", "Individuals"), .(mean_i_c = mean(i_c)), by = .(industry, fy, industry_name)]
individuals = ts_[, .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = log(mean_i_c))) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "log(Mean installments per client) over time by industry for companies + individuals")
# Industry table
mean_all_years[, .(industry, industry_name)]
ts_ = payg[entity %in% c("Companies", "Individuals"), .(mean_i_c = mean(i_c)), by = .(industry, fy, industry_name)]
individuals = ts_[, .(mean_i_c, industry, fy, industry_name)]
individuals[, fy := as.numeric(fy)]
mean_all_years = individuals[, .(mean_ = mean(mean_i_c)), by = .(industry, industry_name)]
setorder(mean_all_years,-mean_)
individuals[, industry := factor(industry, levels = unique(mean_all_years$industry))]
# plot
ggplot(data = individuals, aes(x = fy, y = log(mean_i_c))) +
geom_line(aes(color = industry)) +
scale_x_discrete(name = "End of financial year", limits = c(2011:2019)) +
scale_y_continuous(name = "Mean installments per client") +
ggtitle(label = "log(Mean installments per client) over time by industry for \n companies + individuals")
# Industry table
mean_all_years[, .(industry, industry_name)]
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
payg_19 = payg[fy == "2019", .(entity, industry_name, clients, industry, installments)]
payg_19 = payg[fy == "2019", .(entity, industry_name, clients, industry, installments, i_c)]
library(data.table)
dt = fread("../data/industry_incomes.csv")
# Subset to variables of interest
industry = dt[, .(
`Number of individuals`,
`Broad Industry1`,
`Number of individuals`,
`Taxable income or loss3
no.`,
`Taxable income or loss3$`
)]
industry = dt[, .(
`Number of individuals`,
`Broad Industry1`,
`Number of individuals`,
`Taxable income or loss3
no.`,
`Taxable income or loss3$`
)]
industry = dt[, .(
`Number of individuals`,
`Broad Industry1`,
`Number of individuals`,
`Taxable income or loss3
no.`,
`Taxable income or loss3
$`
)]
# Subset to variables of interest
industry = dt[, .(
`Number of individuals`,
`Broad Industry1`,
`Number of individuals`,
`Taxable income or loss3
no.`,
`Taxable income or loss3
$`
)]
# Clean variables
industry[, no_indv := `Number of individuals`]
industry[, `Number of individuals` := NULL]
industry[, industry := `Broad Industry1`]
industry[, `Broad Industry1` := NULL]
industry[, tax_num := `Taxable income or loss3
no.`]
industry[, `Taxable income or loss3
no.` := NULL]
industry[, incm_or_lss := `Taxable income or loss3
$`]
industry[, `Taxable income or loss3
$` := NULL]
industry
industry[, tax_num := `Taxable income or loss3
no.`]
# Subset to variables of interest
industry = dt[, .
`Number of individuals`,
# Subset to variables of interest
industry = dt[, .(
`Number of individuals`,
`Broad Industry1`,
`Number of individuals`,
`Taxable income or loss3
no.`,
`Taxable income or loss3
$`
)]
# Clean variables
industry[, no_indv := `Number of individuals`]
industry[, `Number of individuals` := NULL]
names(industry)
industry[, "Number of individuals" := NULL]
names(industry)
dt = fread("../data/industry_incomes.csv")
# Subset to variables of interest
industry = dt[, .(
`Number of individuals`,
`Broad Industry1`,
`Number of individuals`,
`Taxable income or loss3
no.`,
`Taxable income or loss3
$`
)]
# Clean variables
industry[, no_indv := `Number of individuals`]
industry[, "Number of individuals" := NULL]
industry[, industry := `Broad Industry1`]
industry[, "Broad Industry1" := NULL]
industry[, tax_num := `Taxable income or loss3
no.`]
industry[, "Taxable income or loss3\nno." := NULL]
industry[, incm_or_lss := `Taxable income or loss3
$`]
industry[, "Taxable income or loss3\n$" := NULL]
industry
# clean numerics
fn_ = function(x) (as.numeric(gsub(",", "", x)))
industry[, "Number of individuals" := NULL]
industry
industry[, (cols_) := lapply(X = .SD, FUN = fn_), .SDcols = cols_]
cols_ = c("no_indv", "incm_or_lss", "tax_num")
industry
industry[, (cols_) := lapply(X = .SD, FUN = fn_), .SDcols = cols_]
industry
